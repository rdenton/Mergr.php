#!/usr/bin/env php
<?php eval(base64_decode('Y2xhc3MgbWVyZ3IgewoJCglwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoJGRpcmVjdG9yeT1udWxsLCRvcHRpb25zKSB7CgkJCgkJJHRoaXMtPm9wdGlvbnMgPSAkb3B0aW9uczsKCQkKCQkvL01ha2Ugc3VyZSB3ZSBoYXZlIGEgZGlyZWN0b3J5IHRvIHdvcmsgd2l0aC4KCQlpZiAoISAkZGlyZWN0b3J5KSB7CgkJCXByaW50KCJObyBkaXJlY3Rvcnkgc3BlY2lmaWVkXG4iKTsKCQkJZXhpdDsKCQl9CgkJCgkJLy9DaGVjayB0aGUgZGlyZWN0b3J5IGV4aXN0cy4KCQlpZiAoISBmaWxlX2V4aXN0cygkZGlyZWN0b3J5KSB8fCAhaXNfZGlyKCRkaXJlY3RvcnkpICkgewoJCQlwcmludCgiRGlyZWN0b3J5IHNwZWNpZmllZCBkb2Vzbid0IGV4aXN0LlxuIik7CgkJCWV4aXQ7CgkJfQoJCQoJCS8vVGhlIGRpcmVjdG9yeSBleGlzdHMuCgkJLy9DaGVjayBpZiB0aGVyZSBpcyBDU1MgdG8gcHJvY2Vzcy4KCQkKCQlpZiAoIGZpbGVfZXhpc3RzKCRkaXJlY3RvcnkgLiAiL2NzcyIpICYmIGlzX2RpcigkZGlyZWN0b3J5IC4gIi9jc3MiKSApIHsKCQkJLy9MaXN0IENTUyBmaWxlcyB0byBwcm9jZXNzLgoJCQkkdGhpcy0+Y3NzX3Byb2Nlc3MgPSAkdGhpcy0+c2NhbmRpcmVjdG9yeSgkZGlyZWN0b3J5IC4gIi9jc3MiLCAiLmNzcyIpOwoJCX0KCQkKCQkvL0NoZWNrIGlmIHRoZXJlIGlzIEpTIHRvIHByb2Nlc3MuCgkJCgkJaWYgKCBmaWxlX2V4aXN0cygkZGlyZWN0b3J5IC4gIi9qcyIpICYmIGlzX2RpcigkZGlyZWN0b3J5IC4gIi9qcyIpICkgewoJCQkvL0xpc3QgSlMgZmlsZXMgdG8gcHJvY2Vzcy4KCQkJJHRoaXMtPmpzX3Byb2Nlc3MgPSAkdGhpcy0+c2NhbmRpcmVjdG9yeSgkZGlyZWN0b3J5IC4gIi9qcyIsICIuanMiKTsKCQl9CgoJCQoJfQoJCglwcm90ZWN0ZWQgZnVuY3Rpb24gc2NhbmRpcmVjdG9yeSgkZGlyZWN0b3J5PW51bGwsJGZpbGVfZXh0ZW5zaW9uPSIuY3NzIikgewoJCQoJCWlmICghICRkaXJlY3RvcnkgKSB7CgkJCXByaW50KCJObyBkaXJlY3Rvcnkgc3BlY2lmaWVkIGluIHNjYW5kaXJlY3RvcnkoKTsgZnVuY3Rpb25cbiIpOwoJCQlleGl0OwoJCX0KCQkKCQkkZmlsZV9saXN0ID0gc2NhbmRpcigkZGlyZWN0b3J5KTsKCQlpZiAoIGNvdW50KCRmaWxlX2xpc3QpID4gMCApIHsKCQkJCgkJCSRyZXR1cm5fYXJyYXkgPSBudWxsOwoJCQkKCQkJZm9yZWFjaCgkZmlsZV9saXN0IGFzICRmaWxlKSB7CgkJCQlpZiAoIGZpbGVfZXhpc3RzKCRkaXJlY3RvcnkgLiAiLyIgLiAkZmlsZSkgJiYgIWlzX2RpcigkZGlyZWN0b3J5IC4gIi8iIC4gJGZpbGUpICkgewoJCQkJCS8vVmFsaWQgZmlsZS4KCQkJCQkvL0NoZWNrIGZvciBDU1MgZXh0ZW5zaW9uLgoJCQkJCWlmICggc3Vic3RyKCRmaWxlLCAtc3RybGVuKCRmaWxlX2V4dGVuc2lvbikpID09ICRmaWxlX2V4dGVuc2lvbiAmJiAkZmlsZSAhPSAiZ2xvYmFsLm1pbiIgLiAkZmlsZV9leHRlbnNpb24pIHsKCQkJCQkJJHJldHVybl9hcnJheVtdID0gJGRpcmVjdG9yeSAuICIvIiAuICRmaWxlOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQkKCQkJcmV0dXJuICRyZXR1cm5fYXJyYXk7CgkJCQoJCX0gZWxzZSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CQkKCQkKCX0KCQoJcHVibGljIGZ1bmN0aW9uIG1lcmdlX2NzcygkZGlyZWN0b3J5KSB7CgkJCgkJaWYgKCBjb3VudCgkdGhpcy0+Y3NzX3Byb2Nlc3MpID49IDEgKSB7CgkJCS8vTWFyZ2UgdGhlIENTUy4KCQkJCgkJCSRtZXJnZV9idWZmZXIgPSBudWxsOwoJCQkkbWVyZ2VfY291bnQgPSAwOwoJCQkKCQkJZm9yZWFjaCgkdGhpcy0+Y3NzX3Byb2Nlc3MgYXMgJGZpbGUpIHsKCQkJCQoJCQkJaWYgKCAkZmlsZSAhPSBudWxsICkgewoJCQkJCQoJCQkJCSRmaWxlX2RhdGEgPSBudWxsOwoJCQkJCQoJCQkJCSRmaWxlc2l6ZSA9IGZpbGVzaXplKCRmaWxlKTsKCQkJCQlpZiAoICRmaWxlc2l6ZSA+IDAgKSB7CgkJCQkJCgkJCQkJCSRmaCA9IEBmb3BlbigkZmlsZSwgInIiKTsKCQkJCQkJaWYgKCAkZmggKSB7CgkJCQkJCQkkZmlsZV9kYXRhID0gZnJlYWQoJGZoLCAkZmlsZXNpemUpOwoJCQkJCQkJZmNsb3NlKCRmaCk7CgkJCQkJCQoJCQkJCQkJaWYgKCAkZmlsZV9kYXRhICkgewoJCQkJCQkJCS8vQWRkIHRvIG1lcmdlIGJ1ZmZlci4KCQkJCQkJCQkkbWVyZ2VfYnVmZmVyIC49ICRmaWxlX2RhdGE7CgkJCQkJCQkJJG1lcmdlX2NvdW50Kys7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJCgkJCQkJfQoJCQkJCQoJCQkJfQoJCQkJCgkJCX0KCQkJCgkJCWlmICghICR0aGlzLT5vcHRpb25zWyduby1wbHVnaW5zJ10gKSB7CgkJCQkvL0V4ZWN1dGUgZmlsdGVyIHBsdWdpbnMuCgkJCQkkbWVyZ2VfYnVmZmVyID0gbWVyZ3JfZXhlY3V0ZV9wbHVnaW5zKCAiZmlsdGVyIiwiY3NzIiwgJG1lcmdlX2J1ZmZlciApOwoJCQl9CgkJCQoJCQkvL1dyaXRlIHRoZSBmaWxlLgoJCQkkZmggPSBAZm9wZW4oJGRpcmVjdG9yeSAuICIvY3NzL2dsb2JhbC5taW4uY3NzIiwgInciKTsKCQkJaWYgKCAhJGZoICkgewoJCQkJcHJpbnQoIkVycm9yOiBDb3VsZG4ndCB3cml0ZSBnbG9iYWwubWluLmNzcyBtZXJnZWQgZmlsZS5cbiIpOwoJCQkJZXhpdDsKCQkJfQoJCQkKCQkJZndyaXRlKCRmaCwgJG1lcmdlX2J1ZmZlcik7CgkJCWZjbG9zZSgkZmgpOwoJCQkKCQkJcHJpbnQoIk1lcmdlZCAiIC4gJG1lcmdlX2NvdW50IC4gIiBmaWxlcy4gT3V0cHV0IGhhcyBiZWVuIHNhdmVkIHRvICIgLiAkZGlyZWN0b3J5IC4gIi9jc3MvZ2xvYmFsLm1pbi5jc3NcbiIpOwoJCQkKCQkJcmV0dXJuIHRydWU7CgkJCQoJCX0gZWxzZSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgkJCgl9CgkKCXByb3RlY3RlZCBmdW5jdGlvbiBwbHVnaW5fZXhlY3V0ZSgkb3BlcmF0aW9uLCAkdHlwZSkgewoJCQoJCWdsb2JhbCAkbWVyZ3JfcGx1Z2luczsKCQkKCX0KCQoJcHVibGljIGZ1bmN0aW9uIHdhdGNoKCkgewoJCQoJCS8vSXMgdGhpcyB0aGUgZmlyc3QgdGltZSB3ZSd2ZSBydW4gd2F0Y2goKT8KCQlpZiAoISBwcm9wZXJ0eV9leGlzdHMoJHRoaXMsICJ3YXRjaGxpc3QiKSApIHsKCQkJLy9IYXNuJ3QgYmVlbiBydW4geWV0LgoJCQkkdGhpcy0+d2F0Y2hsaXN0ID0gbnVsbDsKCQkJZm9yZWFjaCgkdGhpcy0+Y3NzX3Byb2Nlc3MgYXMgJGZpbGUpIHsKCQkJCSR0aGlzLT53YXRjaGxpc3RbXSA9IGFycmF5KAoJCQkJCSJmaWxlIiA9PiAkZmlsZSwKCQkJCQkiaGFzaCIgPT4gaGFzaF9maWxlKCJzaGEyNTYiLCAkZmlsZSkKCQkJCSk7CgkJCX0KCQkJcmV0dXJuIHRydWU7CgkJfQoJCQoJCSRyZXN1bHQgPSBmYWxzZTsKCQkKCQkvL0xvb3AgdGhyb3VnaCBlYWNoIGZpbGUgaW4gdGhlIHdhdGNoIGxpc3QgYW5kIGNhbGN1bGF0ZSBpdCdzIE1ENSBzdW0uCgkJCgkJZm9yKCRpPTA7JGk8Y291bnQoJHRoaXMtPndhdGNobGlzdCk7JGkrKykgewoJCQkkY3VycmVudF9oYXNoID0gaGFzaF9maWxlKCJzaGEyNTYiLCAkdGhpcy0+d2F0Y2hsaXN0WyRpXVsiZmlsZSJdKTsKCQkJaWYgKCAkY3VycmVudF9oYXNoICE9ICR0aGlzLT53YXRjaGxpc3RbJGldWyJoYXNoIl0gKSB7CgkJCQkvL0ZpbGVzIGhhdmUgY2hhbmdlZC4KCQkJCSRyZXN1bHQgPSB0cnVlOwoJCQkJJHRoaXMtPndhdGNobGlzdFskaV1bImhhc2giXSA9ICRjdXJyZW50X2hhc2g7CgkJCX0KCQl9CgkJCgkJCgkJcmV0dXJuICRyZXN1bHQ7CgkJCgl9CgkKfQoKJG1lcmdyX3BsdWdpbnMgPSBhcnJheSgpOwoKZnVuY3Rpb24gbWVyZ3JfZmluZF9wbHVnaW5zKCkgewoJCgkvL1NjYW4gdGhlIC9wbHVnaW5zIGRpcmVjdG9yeS4KCSRmaWxlcyA9IHNjYW5kaXIoInBsdWdpbnMvIik7Cglmb3JlYWNoKCAkZmlsZXMgYXMgJGZpbGUgKSB7CgkJCgkJaWYgKCAkZmlsZSAhPSAiLiIgJiYgJGZpbGUgIT0gIi4uIiAmJiBzdWJzdHIoJGZpbGUsLTQpID09ICIucGhwIiApIHsKCQkJCgkJCS8vUGx1Z2luIGZvdW5kLgoJCQkvL0luY2x1ZGUgdGhlIHBsdWdpbi4KCQkJaW5jbHVkZSAicGx1Z2lucy8iIC4gJGZpbGU7CgkJCQoJCX0KCQkKCX0KCQp9CgpmdW5jdGlvbiBtZXJncl9yZWdpc3Rlcl9wbHVnaW4oJGZ1bmN0aW9uX3R5cGUsJGZ1bmN0aW9uX2ZpbGVfdHlwZSwkZnVuY3Rpb25fbmFtZSkgewoJCglnbG9iYWwgJG1lcmdyX3BsdWdpbnM7CgkKCSRtZXJncl9wbHVnaW5zW10gPSBhcnJheSgKCQkiZnVuY3Rpb25fdHlwZSIgPT4gJGZ1bmN0aW9uX3R5cGUsCgkJImZpbGVfdHlwZSIgPT4gJGZ1bmN0aW9uX2ZpbGVfdHlwZSwKCQkiZnVuY3Rpb25fbmFtZSIgPT4gJGZ1bmN0aW9uX25hbWUKCSk7CgkKfQoKZnVuY3Rpb24gbWVyZ3JfZXhlY3V0ZV9wbHVnaW5zKCRmdW5jdGlvbl90eXBlLCRmaWxlX3R5cGUsJGZ1bmN0aW9uX2RhdGE9bnVsbCkgewoJCglnbG9iYWwgJG1lcmdyX3BsdWdpbnM7CgkKCWZvcmVhY2ggKCRtZXJncl9wbHVnaW5zIGFzICRwbHVnaW4pIHsKCQkKCQlpZiAoICRwbHVnaW5bJ2Z1bmN0aW9uX3R5cGUnXSA9PSAkZnVuY3Rpb25fdHlwZSAmJiAkcGx1Z2luWydmaWxlX3R5cGUnXSA9PSAkZmlsZV90eXBlICkgewoJCQkvL0V4ZWN1dGUgdGhlIHBsdWdpbi4KCQkJaWYgKCBmdW5jdGlvbl9leGlzdHMoJHBsdWdpblsnZnVuY3Rpb25fbmFtZSddKSApIHsgCgkJCQlpZiAoISAkZnVuY3Rpb25fZGF0YSApIHsKCQkJCQkkZnVuY3Rpb25fZGF0YSA9IGNhbGxfdXNlcl9mdW5jKCRwbHVnaW5bJ2Z1bmN0aW9uX25hbWUnXSk7CgkJCQl9IGVsc2UgewoJCQkJCSRmdW5jdGlvbl9kYXRhID0gY2FsbF91c2VyX2Z1bmMoJHBsdWdpblsnZnVuY3Rpb25fbmFtZSddLCAkZnVuY3Rpb25fZGF0YSk7CgkJCQl9CgkJCX0KCQl9CgkJCgl9CgkKCXJldHVybiAkZnVuY3Rpb25fZGF0YTsKCQp9CgppZiAoICRhcmdjIDwgMiApIHsKCXByaW50KCJObyBhcmd1bWVudHMgcHJvdmlkZWQuXG4iKTsKCWV4aXQ7Cn0KCi8vRGVmYXVsdCBmdW5jdGlvbgokbWVyZ3JfZnVuY3Rpb24gPSAib25jZS1vZmYiOwoKLy9MYXN0IGFyZ3VtZW50IHNob3VsZCBhbHdheXMgYmUgdGhlIGRpcmVjdG9yeS4KJG1lcmdyX2RpcmVjdG9yeSA9ICRhcmd2WyRhcmdjLTFdOwoKJG1lcmdyX29wdGlvbnMgPSBhcnJheSgKCSJuby1wbHVnaW5zIiA9PiBmYWxzZSwKCSJ3YXRjaCIgPT4gZmFsc2UKKTsKCi8vU2V0IGNvbW1hbmQgYXJndW1lbnRzLgpmb3IoJGk9MTskaTwoJGFyZ2MtMSk7JGkrKykgewoJaWYgKCBzdWJzdHIoJGFyZ3ZbJGldLDAsMikgPT0gIi0tIiApIHsKCQkvL0NoZWNrIGlmIHRoZXJlIGlzIGEgdmFsdWUuCgkJJHZhbCA9IGV4cGxvZGUoIj0iLCAkYXJndlskaV0pOwoJCWlmICggY291bnQoJHZhbCkgPiAxICkgewoJCQkkbWVyZ3Jfb3B0aW9uc1tzdWJzdHIoJHZhbFswXSwyKV0gPSAkdmFsWzFdOwoJCX0gZWxzZSB7CgkJCSRtZXJncl9vcHRpb25zW3N1YnN0cigkYXJndlskaV0sMildID0gdHJ1ZTsKCQl9Cgl9Cn0KCgovL0NoZWNrIG9wdGlvbnMuCi8vU2V0IGZ1bmN0aW9uIGFjY29yZGluZ2x5LgppZiAoICRtZXJncl9vcHRpb25zWyd3YXRjaCddICkgewoJJG1lcmdyX2Z1bmN0aW9uID0gIndhdGNoIjsKCXByaW50ICJNZXJnci5waHAgd2lsbCB3YXRjaCAiIC4gJG1lcmdyX2RpcmVjdG9yeSAuICIgZm9yIGNoYW5nZXNcblByZXNzIENUUkwgKyBDIHRvIGNhbmNlbFxuIjsKfQoKCi8vQnJvd3NlIGZvciBwbHVnaW5zLgptZXJncl9maW5kX3BsdWdpbnMoKTsKCnN3aXRjaCgkbWVyZ3JfZnVuY3Rpb24pIHsKCQoJY2FzZSAib25jZS1vZmYiOgoJCWlmICggJG1lcmdyX2RpcmVjdG9yeSA9PSBudWxsICkgewoJCQlwcmludCgiTm8gZGlyZWN0b3J5IHNwZWNpZmllZFxuIik7CgkJCWV4aXQ7CgkJfQoJCQoJCS8vRG8gdGhlIG1lcmdlLgoJCSRtZXJnciA9IG5ldyBtZXJncigkbWVyZ3JfZGlyZWN0b3J5LCAkbWVyZ3Jfb3B0aW9ucyk7CgkJJG1lcmdyLT5tZXJnZV9jc3MoJG1lcmdyX2RpcmVjdG9yeSk7CgkJCgkJYnJlYWs7CgkJCgljYXNlICJ3YXRjaCI6CgkJCgkJJG1lcmdyID0gbmV3IG1lcmdyKCRtZXJncl9kaXJlY3RvcnksICRtZXJncl9vcHRpb25zKTsKCQkKCQl3aGlsZSAoMSkgewoJCQkKCQkJaWYoICRtZXJnci0+d2F0Y2goKSApIHsKCQkJCS8vVXBkYXRlIGZpbGVzLgoJCQkJcHJpbnQgIkNoYW5nZSBkZXRlY3RlZC4gUmUtbWVyZ2luZy5cbiI7CgkJCQkkbWVyZ3ItPm1lcmdlX2NzcygkbWVyZ3JfZGlyZWN0b3J5KTsKCQkJfQkJCQoJCQkKCQkJLy9TY2FuIGZpbGVzIGV2ZXJ5IG9uZSBtaW51dGUuCgkJCXNsZWVwKDEpOwoJCQkKCQl9CgkJCgkJYnJlYWs7CgkKfQo=')); ?>
